<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern Fetch API Practice</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8 font-sans">

  <h1 class="text-3xl font-bold mb-6 text-center">Modern Fetch API Practice</h1>

  <!-- Public API -->
  <section class="mb-10">
    <h2 class="text-2xl font-semibold mb-2">Posts from JSONPlaceholder</h2>
    <button id="loadPosts" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Load Posts</button>
    <p id="postsStatus" class="my-2 text-blue-600"></p>
    <ul id="postsList" class="mt-4 space-y-2"></ul>
  </section>

  <!-- Local JSON -->
  <section class="mb-10">
    <h2 class="text-2xl font-semibold mb-2">Users from Local JSON</h2>
    <button id="loadUsers" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Load Users</button>
    <p id="usersStatus" class="my-2 text-green-600"></p>
    <ul id="usersList" class="mt-4 space-y-2"></ul>
  </section>

  <!-- POST Example -->
  <section class="mb-10">
    <h2 class="text-2xl font-semibold mb-2">Add New Post (Public API)</h2>
    <form id="postForm" class="flex flex-col gap-2 max-w-md">
      <input type="text" id="title" placeholder="Title" required class="border rounded px-2 py-1">
      <input type="text" id="body" placeholder="Body" required class="border rounded px-2 py-1">
      <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">Add Post</button>
    </form>
    <div class="mt-4">
      <p id="postResponse" class="text-purple-600 mb-2"></p>
      <table id="postTable" class="min-w-full border-collapse hidden">
        <thead>
          <tr class="bg-purple-200">
            <th class="border px-2 py-1">ID</th>
            <th class="border px-2 py-1">Title</th>
            <th class="border px-2 py-1">Body</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <script>
    // -------- Helper Functions --------
    function showList(items, container, statusMsg) {
      container.innerHTML = '';
      items.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = item;
        li.className = "bg-white shadow p-2 rounded opacity-0";
        container.appendChild(li);
        setTimeout(() => li.classList.add("opacity-100"), index * 100);
      });
      statusMsg.textContent = '';
    }

    function showError(statusMsg, msg) {
      statusMsg.textContent = msg;
      statusMsg.classList.add('text-red-600');
    }

    // -------- GET: Public API --------
    const loadPostsBtn = document.getElementById('loadPosts');
    const postsList = document.getElementById('postsList');
    const postsStatus = document.getElementById('postsStatus');

    loadPostsBtn.addEventListener('click', () => {
      postsStatus.textContent = 'Loading posts...';
      postsStatus.className = 'text-blue-600 my-2';
      postsList.innerHTML = '';
      
      fetch('https://jsonplaceholder.typicode.com/posts')
        .then(res => res.json())
        .then(data => {
          const postsArr = data.slice(0,5).map(p => `${p.id}. ${p.title}`);
          showList(postsArr, postsList, postsStatus);
        })
        .catch(err => showError(postsStatus, 'Error loading posts!'));
    });

    // -------- GET: Local JSON --------
    const loadUsersBtn = document.getElementById('loadUsers');
    const usersList = document.getElementById('usersList');
    const usersStatus = document.getElementById('usersStatus');

    loadUsersBtn.addEventListener('click', () => {
      usersStatus.textContent = 'Loading users...';
      usersStatus.className = 'text-green-600 my-2';
      usersList.innerHTML = '';

      fetch('localData.json')
        .then(res => res.json())
        .then(data => {
          const usersArr = data.map(u => `ID: ${u.id}, Name: ${u.name}, Age: ${u.age}`);
          showList(usersArr, usersList, usersStatus);
        })
        .catch(err => showError(usersStatus, 'Error loading users!'));
    });

    // -------- POST: Public API --------
    const postForm = document.getElementById('postForm');
    const postResponse = document.getElementById('postResponse');
    const postTable = document.getElementById('postTable');
    const postTableBody = postTable.querySelector('tbody');

    postForm.addEventListener('submit', (e) => {
      e.preventDefault();
      postResponse.textContent = 'Sending post...';
      postResponse.className = 'text-purple-600';

      const title = document.getElementById('title').value;
      const body = document.getElementById('body').value;

      fetch('https://jsonplaceholder.typicode.com/posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, body, userId: 1 })
      })
      .then(res => res.json())
      .then(data => {
        postResponse.textContent = `Post added!`;
        postTableBody.innerHTML = `
          <tr>
            <td class="border px-2 py-1">${data.id}</td>
            <td class="border px-2 py-1">${data.title}</td>
            <td class="border px-2 py-1">${data.body}</td>
          </tr>`;
        postTable.classList.remove('hidden');
        postForm.reset();
      })
      .catch(err => showError(postResponse, 'Error adding post!'));
    });
  </script>
</body>
</html>
